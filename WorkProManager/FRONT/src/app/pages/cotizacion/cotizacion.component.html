<div class="wpm-custom-gradient p-6 sm:p-4 lg:p-8 rounded-lg shadow-md">
    <div class="contenedor px-4 sm:px-6 lg:px-8">
      <div class="main max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-4 text-center">Crear Cotización</h2>
        <form [formGroup]="cotizacionForm" (ngSubmit)="onSubmit()" class="space-y-6 sm:space-y-4 lg:space-y-8" >
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <!-- Datos Cliente -->
            <fieldset class="col-span-2 border border-gray-200 p-4 rounded-lg">
              <legend class="text-lg font-semibold">Datos del Cliente</legend>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group flex items-end">
                    <div class="w-3/4">
                        <label for="rut_cli" class="block text-sm font-medium text-gray-700">RUT:</label>
                        <input id="rut_cli" formControlName="rut_cli" type="number" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                        <span *ngIf="cotizacionForm.get('rut_cli')?.touched && cotizacionForm.get('rut_cli')?.hasError('required')" class="text-red-500 text-sm">El RUT es obligatorio.</span>
                        <span *ngIf="cotizacionForm.get('rut_cli')?.touched && cotizacionForm.get('rut_cli')?.hasError('pattern')" class="text-red-500 text-sm">Solo se permiten números.</span>
                    </div>
                    
                    <div class="w-1/4 ml-2">
                        <label for="d_ver_cli" class="block text-sm font-medium text-gray-700">DV:</label>
                        <input id="d_ver_cli" formControlName="d_ver_cli" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                        <span *ngIf="cotizacionForm.get('d_ver_cli')?.touched && cotizacionForm.get('d_ver_cli')?.hasError('required')" class="text-red-500 text-sm">El DV es obligatorio.</span>
                        <span *ngIf="cotizacionForm.get('d_ver_cli')?.touched && cotizacionForm.get('d_ver_cli')?.hasError('pattern')" class="text-red-500 text-sm">Solo se permiten números o 'K'.</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email_cli" class="block text-sm font-medium text-gray-700">Email:</label>
                    <input id="email_cli" formControlName="email_cli" type="email" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                    <span *ngIf="cotizacionForm.get('email_cli')?.touched && cotizacionForm.get('email_cli')?.hasError('required')" class="text-red-500 text-sm">El email es obligatorio.</span>
                    <span *ngIf="cotizacionForm.get('email_cli')?.touched && cotizacionForm.get('email_cli')?.hasError('email')" class="text-red-500 text-sm">Formato de email inválido.</span>
                </div>
                <div class="form-group">
                  <label for="nom_cli" class="block text-sm font-medium text-gray-700">Nombre:</label>
                  <input id="nom_cli" formControlName="nom_cli" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                  <span *ngIf="cotizacionForm.get('nom_cli')?.touched && cotizacionForm.get('nom_cli')?.hasError('required')" class="text-red-500 text-sm">El nombre es obligatorio.</span>
                  <span *ngIf="cotizacionForm.get('nom_cli')?.touched && cotizacionForm.get('nom_cli')?.hasError('pattern')" class="text-red-500 text-sm">Solo se permiten letras.</span>
                </div>
                <div class="form-group">
                  <label for="ape_cli" class="block text-sm font-medium text-gray-700">Apellido:</label>
                  <input id="ape_cli" formControlName="ape_cli" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                  <span *ngIf="cotizacionForm.get('ape_cli')?.touched && cotizacionForm.get('ape_cli')?.hasError('required')" class="text-red-500 text-sm">El apellido es obligatorio.</span>
                  <span *ngIf="cotizacionForm.get('ape_cli')?.touched && cotizacionForm.get('ape_cli')?.hasError('pattern')" class="text-red-500 text-sm">Solo se permiten letras.</span>
                </div>
                <div class="form-group col-span-2">
                  <label for="dir_cli" class="block text-sm font-medium text-gray-700">Dirección:</label>
                  <input id="dir_cli" formControlName="dir_cli" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                  <span *ngIf="cotizacionForm.get('dir_cli')?.touched && cotizacionForm.get('dir_cli')?.hasError('required')" class="text-red-500 text-sm">La dirección es obligatoria.</span>
                </div>
                <div class="form-group w-1/2">
                  <label for="tel_cli" class="block text-sm font-medium text-gray-700">Teléfono:</label>
                  <input id="tel_cli" formControlName="tel_cli" type="text" maxlength="9" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                  <span *ngIf="cotizacionForm.get('tel_cli')?.touched && cotizacionForm.get('tel_cli')?.hasError('required')" class="text-red-500 text-sm">El teléfono es obligatorio.</span>
                  <span *ngIf="cotizacionForm.get('tel_cli')?.touched && cotizacionForm.get('tel_cli')?.hasError('pattern')" class="text-red-500 text-sm">Debe tener 9 dígitos.</span>
                </div>
                
              </div>
            </fieldset>

            <!-- Datos del Equipo -->
            <fieldset class="col-span-2 border border-gray-200 p-4 rounded-lg">
                <legend class="text-lg font-semibold">Datos del Equipo</legend>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="num_ser" class="block text-sm font-medium text-gray-700">Número de Serie:</label>
                        <input id="num_ser" formControlName="num_ser" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                    </div>
                    <div class="form-group">
                        <label for="id_marca" class="block text-sm font-medium text-gray-700">ID Marca:</label>
                        <input id="id_marca" formControlName="id_marca" type="number" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                        <span *ngIf="cotizacionForm.get('id_marca')?.touched && cotizacionForm.get('id_marca')?.hasError('required')" class="text-red-500 text-sm">El ID de la marca es obligatorio.</span>
                    </div>
                    <div class="form-group">
                        <label for="tip_equ" class="block text-sm font-medium text-gray-700">Tipo de Equipo:</label>
                        <input id="tip_equ" formControlName="tip_equ" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                    </div>
                </div>
            </fieldset>

            <!-- Datos Orden de Trabajo -->
            <fieldset class="col-span-2 border border-gray-200 p-4 rounded-lg">
              <legend class="text-lg font-semibold">Datos de la Orden de Trabajo</legend>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="fec_ter" class="block text-sm font-medium text-gray-700">Fecha de Término:</label>
                  <input id="fec_ter" formControlName="fec_ter" type="date" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                  <span *ngIf="cotizacionForm.get('fec_ter')?.touched && cotizacionForm.get('fec_ter')?.hasError('required')" class="text-red-500 text-sm">La fecha de término es obligatoria.</span>
                </div>
                <div class="form-group col-span-2">
                  <label for="desc_ot" class="block text-sm font-medium text-gray-700">Descripción:</label>
                  <textarea id="desc_ot" formControlName="desc_ot" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500" rows="5"></textarea>
                  <span *ngIf="cotizacionForm.get('desc_ot')?.touched && cotizacionForm.get('desc_ot')?.hasError('required')" class="text-red-500 text-sm">La descripción es obligatoria.</span>
                </div>
                <div class="form-group col-span-2">
                  <label for="det_adic" class="block text-sm font-medium text-gray-700">Detalles Adicionales:</label>
                  <textarea id="det_adic" formControlName="det_adic" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500" rows="3"></textarea>
                </div>
              </div>
            </fieldset>

            <!-- Datos del Servicio -->
            <fieldset class="col-span-2 border border-gray-200 p-4 rounded-lg mx-auto w-3/4">
              <legend class="text-lg font-semibold text-center">Datos del Servicio</legend>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label for="id_serv" class="block text-sm font-medium text-gray-700 mb-2">Selecciona un Servicio:</label>
                  <select id="id_serv" formControlName="id_serv" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                    <!-- Opciones del dropdown -->
                    <option *ngFor="let servicio of servicios" [value]="servicio.id">{{ servicio.nombre }}</option>
                  </select>
                  <span *ngIf="cotizacionForm.get('id_serv')?.touched && cotizacionForm.get('id_serv')?.hasError('required')" class="text-red-500 text-sm">Selecciona un servicio.</span>
                </div>
                <div class="flex items-end justify-end">
                  <button type="button" (click)="anadirServicio()" class="bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600">Añadir Servicio</button>
                </div>
              </div>

              <!-- Lista de servicios añadidos -->
              <div *ngIf="alertVisible" class="alert">
                <p>¿Estás seguro que deseas eliminar el servicio de "<strong>{{ servicioAEliminar?.nombre }}</strong>"?</p>
                <div class="flex justify-end">
                  <button type="button" (click)="confirmarEliminarServicio()" class="bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 mr-2">Sí</button>
                  <button type="button" (click)="cancelarEliminarServicio()" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded hover:bg-yellow-600">No</button>
                </div>
              </div>
              <div *ngIf="serviciosAnadidos.length > 0" class="mt-4">
                <h3 class="font-semibold">Servicios Añadidos:</h3>
                <ul>
                  <li *ngFor="let servicio of serviciosAnadidos">
                    {{ servicio.nombre }}
                    <button type="button" (click)="mostrarAlertaEliminarServicio(servicio)" class="text-red-500 ml-4">Eliminar</button>
                  </li>
                </ul>
              </div>
            </fieldset>

            <!-- Datos de Asignación -->
            <fieldset class="col-span-2 border border-gray-200 p-4 rounded-lg">
              <legend class="text-lg font-semibold">Datos de Asignación</legend>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Eliminar el campo RUT Gestor -->
                <div class="form-group">
                  <label for="rut_tec" class="block text-sm font-medium text-gray-700">RUT Técnico:</label>
                  <input id="rut_tec" formControlName="rut_tec" type="number" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                </div>
                <div class="form-group col-span-2">
                  <label for="notas_asig" class="block text-sm font-medium text-gray-700">Notas Asignadas:</label>
                  <input id="notas_asig" formControlName="notas_asig" type="text" class="block w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-blue-500">
                </div>
              </div>
            </fieldset>

            <!-- Botón para Enviar -->
            <div class="col-span-2 text-center mt-4">
              <button type="submit" [disabled]="cotizacionForm.invalid" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Enviar Cotización</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
